# HTTP

## HTTP首部





## HTTPS

### 对称加密

A与 B 之间之间的通讯数据都用同一套的密钥来进行加密解密。

- 优点
   简单快捷，密钥较短，且破译困难。
- 缺点
   如果用户一旦多的话，管理密钥也是一种困难。不方便直接沟通的两个用户之间怎么确定密钥也需要考虑，这其中就会有密钥泄露的风险，以及存在更换密钥的需求。

对称加密通常有 **DES,IDEA,3DES** 加密算法。

### 非对称加密

用公钥和私钥来加解密的算法。打个比方，A 的公钥加密过的东西只能通过 A 的私钥来解密；同理，A 的私钥加密过的东西只能通过 A 的公钥来解密。顾名思义，公钥是公开的，别人可以获取的到；私钥是私有的，只能自己拥有。

- 缺点
   加解密比对称加密耗时.
- 优点
   比对称加密安全.

但是非对称加密也是存在漏洞，因为公钥是公开的，如果有 C 冒充 B 的身份利用 A 的公钥给 A 发消息，这样就乱套了，所以接下来就采用非对称加密+摘要算法+数字签名的机制来确保传输安全。

常见的非对称加密算法有：**RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用）**

### 四次握手

- 客户端请求建立SSL链接，并向服务端发送一个随机数 session-token1，客户端支持的stl版本和加密算法等，此时是明文传输。
- 服务端回复确认加密算法、一个随机数 session-token2、授信的服务器证书，证书里包含公钥和网站信息，以及整个整数的数字签名
- 客户端收到证书后，利用浏览器内置的证书厂商公钥验证数字签名，证书合法性等，提取服务端的公钥，再生成一个随机数session-token3、并将token1,2,3组合成session key，通过证书里的公钥及加密方法进行加密，将session key发送给服务器
- 服务端收到客户端的回复，利用已知的加解密方式进行解密，得到session key后做对称加密传输数据

### 算法

* 非对称加密算法：RSA，DSA/DSS ECC(椭圆加密) EIGamal
* 对称加密算法：AES，RC4，3DES 
* HASH算法：MD5，SHA1，SHA256

### Hash算法 （摘要算法）

Hash算法的特点是单向不可还原，用户可以通过hash算法对目标信息生成一段特定长度的唯一hash值，却不能通过这个hash值重新获得目标信息。因此Hash算法常用在不可还原的密码存储、信息完整性校验等。只要源数据不同，算法得到的摘要必定不同。

常见的Hash算法有**MD2、MD4、MD5、HAVAL、SHA**



### 握手过程

**1. 浏览器将自己支持的一套加密规则发送给网站。 2.网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器**。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。 
**3. 浏览器获得网站证书之后浏览器要做以下工作**： 
a)  **验证证书的合法性**（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。 
b)  如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。 
c)  **使用约定好的HASH算法计算握手消息，并使用生成的随机数对消息进行加密**，最后将之前生成的所有信息发送给网站。 
**4. 网站接收浏览器发来的数据之后要做以下的操作：** 
a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。 
b)  使用密码加密一段握手消息，发送给浏览器。 
**5. 浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密**。

### 双向认证SSL协议通信过程

(1) 浏览器发送一个连接请求给服务器;服务器将自己的证书(包含服务器公钥S_PuKey)、对称加密算法种类及其他相关信息返回客户端;

(2) 客户端浏览器检查服务器传送到CA证书是否由自己信赖的CA中心签发。若是，执行4步;否则，给客户一个警告信息：询问是否继续访问。

(3) 客户端浏览器比较证书里的信息，如证书有效期、服务器域名和公钥S_PK，与服务器传回的信息是否一致，如果一致，则浏览器完成对服务器的身份认证。

(4) 服务器要求客户端发送客户端证书(包含客户端公钥C_PuKey)、支持的对称加密方案及其他相关信息。收到后，服务器进行相同的身份认证，若没有通过验证，则拒绝连接;

(5) 服务器根据客户端浏览器发送到密码种类，选择一种加密程度最高的方案，用客户端公钥C_PuKey加密后通知到浏览器;

(6) 客户端通过私钥C_PrKey解密后，得知服务器选择的加密方案，并选择一个通话密钥key，接着用服务器公钥S_PuKey加密后发送给服务器;

(7) 服务器接收到的浏览器传送到消息，用私钥S_PrKey解密，获得通话密钥key。

(8) 接下来的数据传输都使用该对称密钥key进行加密。

服务器和用户双方必须都有证书。由此可见，SSL协议是通过非对称密钥机制保证双方身份认证，并完成建立连接，在实际数据通信时通过对称密钥机制保障数据安全性