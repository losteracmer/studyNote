import requests
import simplejson
import time
headers = {
    "User-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4083.0 Safari/537.36",
    "x-requested-with":"XMLHttpRequest",
    "Sec-Fetch-Dest":"empty",
    "Sec-Fetch-Mode":"cors",
    "Sec-Fetch-Site":"same-origin"
}

def login(mail,passwd):
    login_url = "https://w1.v2ai.top/auth/login"
    login_data = {
        "email": mail,
        "passwd": passwd
    }

    # 忽视verify = False的错误提示
    requests.packages.urllib3.disable_warnings()
    # 登录
    login_session = requests.session()
    res = login_session.post(url=login_url,data=login_data,headers=headers,verify=False)
    print("用户 " + mail+ " " + (simplejson.loads(res.text)["msg"]).split('(')[0])
    # 签到
    """
    curl 'https://w1.v2ai.top/user/checkin' \
  -X 'POST' \
  -H 'Accept: application/json, text/javascript, */*; q=0.01' \
  -H 'Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6' \
  -H 'Connection: keep-alive' \
  -H 'Content-Length: 0' \
  -H 'Cookie: _ga=GA1.1.1237592820.1687071015; uid=243893; email=1970139084%40qq.com; key=1190fbf664ca007a067d515696a44d3a02bbabfb50a1d; ip=ac0ff2e533caf7a3f2e6f0bc7606191d; expire_in=1689663051; _gcl_au=1.1.1850673636.1687071054; crisp-client%2Fsession%2Fa47ae3dd-53d8-4b15-afae-fb4577f7bcd0=session_9f5d0431-85f2-4f3f-bbe5-d5938ed0b51b; _ga_NC10VPE6SR=GS1.1.1687536820.8.1.1687536822.0.0.0' \
  -H 'Origin: https://w1.v2ai.top' \
  -H 'Referer: https://w1.v2ai.top/user' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.43' \
  -H 'X-Requested-With: XMLHttpRequest' \
  -H 'sec-ch-ua: "Not.A/Brand";v="8", "Chromium";v="114", "Microsoft Edge";v="114"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "macOS"' \
  --compressed
    """

    checkin=login_session.post(url='https://w1.v2ai.top/user/checkin',headers=headers,allow_redirects = False)
    resp = simplejson.loads(checkin.text)
    print('响应：', resp)
    print('信息：', resp['msg'])
    # 查询详细信息
    used = resp['trafficInfo']['lastUsedTraffic']
    unUsed = resp['trafficInfo']['unUsedTraffic']
    print('已用流量', used)
    print('剩余流量', unUsed)
    # Inquire = login_session.get(url="https://ji-bc.pw/xiaoma/get_user", headers=headers)
    # print('过去使用流量：',simplejson.loads(Inquire.text)['data']['old'])
    # print('上次签到流量：',str(simplejson.loads(Inquire.text)['data']['old_flow'])+'MB')
    # print('今日已用流量：',simplejson.loads(Inquire.text)['data']['now'])
    # print('账户剩余流量：', simplejson.loads(Inquire.text)['data']['over'])

if __name__=="__main__":
    data = {
        'mail': '1970139084@qq.com',
        'passwd': '445247721jc'
    }
    login(data['mail'],data['passwd'])
    print(time.strftime("%Y-%m-%d %H:%M:%S", time.localtime()))

"""
curl 'http://tiview-cn-beijing.bytedance.net/api/2022-07-01/SaveDashboard' \
  -H 'Accept: */*' \
  -H 'Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json' \
  -H 'Cookie: X-Risk-Browser-Id=453d2fe544145c557fc4232a232f4ec9caf4bf319841db750707a1cea31e466b' \
  -H 'Origin: http://tiview-cn-beijing.bytedance.net' \
  -H 'Referer: http://tiview-cn-beijing.bytedance.net/dashboard/3' \
  -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.43' \
  -H 'x-jwt-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNjg4MTAwMjQwfQ.YiWgD7uN7BIRTZ_vryb6M2nNgIGcYRWSzqtZrve8hRA' \
  --data-raw '{"DirectoryId":0,"DashboardId":3,"Name":"ALB实例监控看板-北京","Creator":"","Style":{"2":{"grid":{"x":0,"y":0,"w":3,"h":10}},"9":{"grid":{"x":3,"y":0,"w":3,"h":10}},"10":{"grid":{"x":9,"y":0,"w":3,"h":5}},"11":{"grid":{"x":9,"y":5,"w":3,"h":5}},"12":{"grid":{"x":6,"y":0,"w":3,"h":5}},"13":{"grid":{"x":6,"y":5,"w":3,"h":5}},"14":{"grid":{"x":0,"y":10,"w":3,"h":7}},"15":{"grid":{"x":3,"y":10,"w":3,"h":7}},"16":{"grid":{"x":6,"y":10,"w":3,"h":7}},"17":{"grid":{"x":9,"y":10,"w":3,"h":7}},"28":{"grid":{"x":0,"y":17,"w":3,"h":7}},"29":{"grid":{"x":3,"y":17,"w":3,"h":7}},"30":{"grid":{"x":6,"y":17,"w":3,"h":7}},"31":{"grid":{"x":9,"y":17,"w":3,"h":7}},"32":{"grid":{"x":0,"y":24,"w":3,"h":7}},"33":{"grid":{"x":0,"y":31,"w":3,"h":7}},"34":{"grid":{"x":3,"y":24,"w":3,"h":7}},"35":{"grid":{"x":3,"y":31,"w":3,"h":7}},"36":{"grid":{"x":6,"y":24,"w":3,"h":7}},"37":{"grid":{"x":6,"y":31,"w":3,"h":7}},"38":{"grid":{"x":0,"y":38,"w":6,"h":7}},"39":{"grid":{"x":6,"y":38,"w":6,"h":7}},"40":{"grid":{"x":0,"y":45,"w":3,"h":7}},"41":{"grid":{"x":0,"y":52,"w":3,"h":7}},"42":{"grid":{"x":6,"y":45,"w":3,"h":7}},"43":{"grid":{"x":6,"y":52,"w":3,"h":7}},"44":{"grid":{"x":3,"y":45,"w":3,"h":7}},"45":{"grid":{"x":3,"y":52,"w":3,"h":7}},"46":{"grid":{"x":9,"y":52,"w":3,"h":7}},"47":{"grid":{"x":9,"y":45,"w":3,"h":7}}},"Reports":[{"Id":2,"Name":"QPS","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:ReqTotal | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as qps group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["qps"]}},{"Id":9,"Name":"并发连接数","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:conns.val | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/__auto__*30 as conns group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{},"yFields":["conns"]}},{"Id":10,"Name":"RT_max","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:RT | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, max(value) as rt group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"ms"},"yFields":["rt"]}},{"Id":11,"Name":"UpsRT_max","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:UpsRT | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, max(value) as upsRt group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"ms"},"yFields":["upsRt"]}},{"Id":12,"Name":"RT_avg","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:RT | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, avg(value) as rt group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"ms"},"yFields":["rt"]}},{"Id":13,"Name":"UpsRT_avg","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:UpsRT | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, avg(value) as upsRt group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"ms"},"yFields":["upsRt"]}},{"Id":14,"Name":"Http2xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http2xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http2xx group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":true},"type":"line","xFields":["t"],"yFields":["http2xx"]}},{"Id":15,"Name":"Http3xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http3xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http3xx group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["http3xx"]}},{"Id":16,"Name":"Http4xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http4xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http4xx group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["http4xx"]}},{"Id":17,"Name":"Http5xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http5xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http5xx group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["http5xx"]}},{"Id":28,"Name":"HttpUps2xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps2xx | select __time__ - __time__ %if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups2xx group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups2xx"]}},{"Id":29,"Name":"HttpUps3xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps3xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups3xx group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups3xx"]}},{"Id":30,"Name":"HttpUps4xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps4xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups4xx group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups4xx"]}},{"Id":31,"Name":"HttpUps5xx","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps5xx | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups5xx group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups5xx"]}},{"Id":32,"Name":"Http404","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http404 | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http404 group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["http404"]}},{"Id":33,"Name":"HttpUps404","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps404 | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups404 group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":true},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups404"]}},{"Id":34,"Name":"Http502","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:Http502 | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as http502 group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["http502"]}},{"Id":35,"Name":"HttpUps502","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUps502 | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as ups502 group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["ups502"]}},{"Id":36,"Name":"HttpOtherStatus","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpOtherStatus | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as otherStatus group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["otherStatus"]}},{"Id":37,"Name":"HttpUpsOtherStatus","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:HttpUpsOtherStatus | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as upsOtherStatus group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":["r/s"]},"yFields":["upsOtherStatus"]}},{"Id":38,"Name":"新建连接数","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.conns | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"Count/s"},"yFields":["res"]}},{"Id":39,"Name":"丢失连接数","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.drop_conns | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{"unit":"Count/s"},"yFields":["res"]}},{"Id":40,"Name":"入流量（bps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.in_bytes | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{},"yFields":["res"]}},{"Id":41,"Name":"出流量（bps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.out_bytes | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yAxis":{},"yFields":["res"]}},{"Id":42,"Name":"入丢流量（bps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.in_drop_bytes | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}},{"Id":43,"Name":"出丢流量（bps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.out_drop_bytes | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}},{"Id":44,"Name":"入包量（pps)","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.in_pkts | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}},{"Id":45,"Name":"出包量（pps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.out_pkts | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}},{"Id":46,"Name":"出丢包量（pps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.out_drop_pkts | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}},{"Id":47,"Name":"入丢包量（pps）","QueryTargets":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","KQL":"metric_name:services.in_drop_pkts | select __time__ - __time__ % if(__auto__<30, 30, __auto__) as t, sum(value)/if(__auto__<30, 30, __auto__)*30 as res group by t order by t\n"}],"Config":{"legend":{"position":"bottom","show":false},"type":"line","xFields":["t"],"yFields":["res"]}}],"Selectors":[{"Id":256,"LogicalId":"f234e0ce-72b6-44e6-9483-b19bafbf0a58","Label":"resource_id","Name":"实例","Source":"relay","SelectMode":"multi","DefaultValues":[],"Options":[],"AllSelect":true,"Exclude":false,"IsHided":false,"DatasourceConfigs":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","FieldName":"resource_id","FieldType":"Varchar","Condition":""}],"OptionValueType":""},{"Id":257,"LogicalId":"62a94528-7c8f-420a-afef-db599f01d38a","Label":"listener_id","Name":"监听","Source":"relay","SelectMode":"single","DefaultValues":[],"Options":[],"AllSelect":true,"Exclude":false,"IsHided":false,"DatasourceConfigs":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","FieldName":"listener_id","FieldType":"Varchar","Condition":"resource_id in ($resource_id)"}],"OptionValueType":""},{"Id":258,"LogicalId":"d85a95ff-9546-419a-9fbf-2cd178b8a0f4","Label":"vip","Name":"VIP","Source":"relay","SelectMode":"multi","DefaultValues":[],"Options":[],"AllSelect":true,"Exclude":false,"IsHided":false,"DatasourceConfigs":[{"Datasource":"dwm_alb_flow_metric_access_metric_stats_30s_hi_beijing","FieldName":"vip","FieldType":"Varchar","Condition":"resource_id in ($resource_id)"}],"OptionValueType":""}],"OprType":"Update"}' \
  --compressed \
  --insecure
"""
